<metadata>
a49890aff880c3ae3955ab8b0d7bddb891e325562940caa5f49afbc6fedcb081efc17a4a6446cded6702721cafcc690656323851a6c81a7d231e55772e5b9ce8ea8cf3defcc4d3f1d0ef3e00605c5b36ec833c58eb9e8ce00b6ef1d1f482f6933a48661589e02649c0ae1f226e4c4a7bcfe149795e7c3a04fec293fdf899016c9cf969575019d8bb6a0280e9fd90afc086ed6510566a87a8137d8aebfb960560f0ce083440347009e595771207392069ff912d49660f1576e2832c581c73f68482be1d3292e66e17c7b7a3c6af91615de8847e1f345af99ec2b7c2a39afd90f5dfe1511c6534c18dfdc9ac90fad58be77f1ec0ae4e29c2b7bbda7d1a583dab95a09c85e49de83f4b6c04107fd5a73608e3a2a0d5f7831d75d9b6eb998db1c2ed2a4b6d18e7930f674c2396e484ba112d385b91fe9af77808fd9cb6d8fb825769a2e1abc46f02a1d1d8b9dcb288f15e625c734f2c85ea9ff27c0c01605f31fa83c2fc063a0f6cadc2e885b8d51471d8b65d29c8bbd0ee3905a986fd9e056aa5c83e537c19fd9384f0e497e0de0834fb98492641318bf284f690f9a1c649218efabecd4d73480b0d621b6bc6bf91e3620b3453224adca8ddfd9dc2cbebe8dae4d4f0c01521b39fd1f186cb5a3f9feb7f1e5706a6d3f49b205487e20a799cbc3261f69995f343376413f2937a08385db3937635e887ef9d3d4d18360935fbd4593a39566d1d4c35a5d74e27492e462ef98df487d2ec675bf2964223fb8f4d2897d8ea8c05461163a8cdd2b3b3c72841d7b8adc3320c8ebc7a438fa1ac9dd4e6e1cfcffd5161ccfcfcc47844cbe45e3a0a6bb1c5cca9c58ac0a6e8abb7c50a6fc4a52a5eaac3afc080eeefd13b07e085f68eabdb387c75146f1b1471d7e9daead9e82b05ba8aa697eec0a1915363a49496a7300cd9f66d08720a4c3cde9a6d0c88fcfe9b2816dfe3adddbddc84f78efd81f6b4db1c6e8ce8f9c7f3cf311e89f9bbdacebdd3a0d7a04e215f2dc9ad2d13c6fa402f6c1996e2a9d988fd0e7a6f510440556f4b170e7e285a6a05670d6e0b6f0cf88cd3a0b8e47323087aa4cb82d69eec9dfc492d2e4be89acaf8b6ea9eceb9ed4e02aae8d8adaac37814472392f71260401cc5a73158d6b8c39fdb9fb1d4d2b0e194f394c894c58ca6c88befe9800162204181f5b3dca2d05c2fe9b57b47ac832847e59023576c1c2b5e3347c9f75468d5a7e1846107b7d201737b1e224c3f5c3d58e99a3806586424562441422477121a682e4bec827d1e234619275c311465335fe7d34c70200f3a48d2b73751284de99b492c8ae427448de892acd1ed0d22daa81a7f1e78f693ddaf87e2432d66050e6b37448db32f13adc4b6d84521167f3152c0a10672f09fdfad723d6414eb9f2148d8b7a9c7592a7c5cacdf4c29caba3d5c2d5f1574b1c5cbaea19c96b43a7cc7a6066ad1a266032604033db488aec2630a0a6495f06747543a2f4e19740f6a576af5d7064a9ef7741a670288a8bb8a391bd7f7d5b60b640f63355aa2d088b5c9ebd9f4c1f77742af9a2211ac9a290b0f2f76056b1f8ef782ee84e1427f2c0ed9e9280a7b5ba2d53851d8bc1561cba3fcc13a18d7e6290bb8861f23715ec2aefa93553b3f5a7a4469555e32a6cf3759583d1f3fa6c874158ce1d5b0a79a1b393b77cea7147a3c59defec8f941630f2ff1923c53137fed82582ab38ea183260b94a5596f546384b3b086023b81b786b71b392202eb9866128af3204ca4c12c115e7c9cacb092fddddfa86c05cbafed99bed6172a93b1300193b1734d122e82add7bbd5bc016f1471724cdae6deb2553c81efa4c13f1f92fc01603c515e3b7b46b391226e6c05127c9efb84a4536182a09fbfaac9b4db375be689c7b53b06c9ebffd2ddea61550236efdc7a4ff1c3b694d9f9265599ed9fe688e4d4b10538a785deee486a4e6e35422e47d5b1c4b07f17675aefcd80b1a082340a6a569db25539d2bb5d334f2a4a74c6fa690500692c42cca95070ef81c4a5d8b51f7a86bb2f0ddc903c55026c7b1e6747f1c281a301215a39513eb6da610eee9c7c41ab898ea390a281b41d2a82b0b487f1c3b28acbe921015f2cec98afd6432f6e0b5d60fddf221281a3d1f1c3b480e9f09485f190f8b28f2a080a3b99bb1729665a8ba40b678ce5b3dd67023e006c50660aed84a2ccafcaa181731d7a1b4429a9ccccf10f2d90dc93fa95fb9df86f4fe0d49bb92d0da1c25e314d21107ff587f0cde2c088a5b7860630c7f061503908665fbc8f31073c1e04249ae913670e77b9d5abcefcc134163d0dfcde0e2e2a5dc2ab7c1864104c24c9f41f3d2e1fcae83b057844d4fbacc01f76fd939df8e4da9ca04925157c046a91f4f9d9442a8bea3c51f095d6eb4361125e0168147a8beeb1917247fbd93818bcdf442b7f134d220270201d3b19f2dfdbec91a534007241e0d5d4e65674c7e71261b6c21168bdd188ed1825f3d16e5e72509cbcfd8af59cacc8780c462e132e9bb9eedfd8fa4a742d11755a95f9bed7d1bf2c49c2fc96aaf995c0a9e48a1277d2f2fc92ec8da3cebbde3a07082af5b93059dab4b5d092b2a4925e7c371783e01976bcd0e88786f4d7ea2200f8d53406f2c7a790201290a31a281e26eac885a541326612d1a859351b7e625f6d4f82b297b560406c1b355cec8833472c447e4310322d1c1634fdc31e22bb94e78b9bf2d2bce3863806724edbf4ec85ff91563282eb492ae1800b7fbdd292e02e616717f581bad3503fc4aa90e34779417daf80264ba2cd1470790c9df16104bd835257c624a3eb8e5b80c89adafc4b1ec0
</metadata>
//+------------------------------------------------------------------+
//|                                                     Ichimoku.mq4 |
//|                      Copyright _ 2004, MetaQuotes Software Corp. |
//|                                       http://www.metaquotes.net/ |
//+------------------------------------------------------------------+
#property copyright "Copyright _ 2004, MetaQuotes Software Corp."
#property link      "http://www.metaquotes.net/"

#property indicator_chart_window
#property indicator_buffers 7
#property indicator_color1 Red
#property indicator_color2 Blue
#property indicator_color3 SandyBrown
#property indicator_color4 Thistle
#property indicator_color5 Lime
#property indicator_color6 SandyBrown
#property indicator_color7 Thistle
//---- input parameters
extern int Tenkan=9;
extern int Kijun=26;
extern int Senkou=52;
//---- buffers
double Tenkan_Buffer[];
double Kijun_Buffer[];
double SpanA_Buffer[];
double SpanB_Buffer[];
double Chinkou_Buffer[];
double SpanA2_Buffer[];
double SpanB2_Buffer[];
//----
int a_begin;
//+------------------------------------------------------------------+
//| Custom indicator initialization function                         |
//+------------------------------------------------------------------+
int init()
  {
//----
   SetIndexStyle(0,DRAW_LINE);
   SetIndexBuffer(0,Tenkan_Buffer);
   SetIndexDrawBegin(0,Tenkan-1);
   SetIndexLabel(0,"Tenkan Sen");
//----
   SetIndexStyle(1,DRAW_LINE);
   SetIndexBuffer(1,Kijun_Buffer);
   SetIndexDrawBegin(1,Kijun-1);
   SetIndexLabel(1,"Kijun Sen");
//----
   a_begin=Kijun; if(a_begin<Tenkan) a_begin=Tenkan;
   SetIndexStyle(2,DRAW_HISTOGRAM,STYLE_DOT);
   SetIndexBuffer(2,SpanA_Buffer);
   SetIndexDrawBegin(2,Kijun+a_begin-1);
   SetIndexShift(2,Kijun);
   SetIndexLabel(2,NULL);
   SetIndexStyle(5,DRAW_LINE,STYLE_DOT);
   SetIndexBuffer(5,SpanA2_Buffer);
   SetIndexDrawBegin(5,Kijun+a_begin-1);
   SetIndexShift(5,Kijun);
   SetIndexLabel(5,"Senkou Span A");
//----
   SetIndexStyle(3,DRAW_HISTOGRAM,STYLE_DOT);
   SetIndexBuffer(3,SpanB_Buffer);
   SetIndexDrawBegin(3,Kijun+Senkou-1);
   SetIndexShift(3,Kijun);
   SetIndexLabel(3,NULL);
   SetIndexStyle(6,DRAW_LINE,STYLE_DOT);
   SetIndexBuffer(6,SpanB2_Buffer);
   SetIndexDrawBegin(6,Kijun+Senkou-1);
   SetIndexShift(6,Kijun);
   SetIndexLabel(6,"Senkou Span B");
//----
   SetIndexStyle(4,DRAW_LINE);
   SetIndexBuffer(4,Chinkou_Buffer);
   SetIndexShift(4,-Kijun);
   SetIndexLabel(4,"Chinkou Span");
//----
   return(0);
  }
//+------------------------------------------------------------------+
//| Ichimoku Kinko Hyo                                               |
//+------------------------------------------------------------------+
int start()
  {
   int    i,k;
   int    counted_bars=IndicatorCounted();
   double high,low,price;
//----
   if(Bars<=Tenkan || Bars<=Kijun || Bars<=Senkou) return(0);
//---- initial zero
   if(counted_bars<1)
     {
      for(i=1;i<=Tenkan;i++)    Tenkan_Buffer[Bars-i]=0;
      for(i=1;i<=Kijun;i++)     Kijun_Buffer[Bars-i]=0;
      for(i=1;i<=a_begin;i++) { SpanA_Buffer[Bars-i]=0; SpanA2_Buffer[Bars-i]=0; }
      for(i=1;i<=Senkou;i++)  { SpanB_Buffer[Bars-i]=0; SpanB2_Buffer[Bars-i]=0; }
     }
//---- Tenkan Sen
   i=Bars-Tenkan;
   if(counted_bars>Tenkan) i=Bars-counted_bars-1;
   while(i>=0)
     {
      high=High[i]; low=Low[i]; k=i-1+Tenkan;
      while(k>=i)
        {
         price=High[k];
         if(high<price) high=price;
         price=Low[k];
         if(low>price)  low=price;
         k--;
        }
      Tenkan_Buffer[i]=(high+low)/2;
      i--;
     }
//---- Kijun Sen
   i=Bars-Kijun;
   if(counted_bars>Kijun) i=Bars-counted_bars-1;
   while(i>=0)
     {
      high=High[i]; low=Low[i]; k=i-1+Kijun;
      while(k>=i)
        {
         price=High[k];
         if(high<price) high=price;
         price=Low[k];
         if(low>price)  low=price;
         k--;
        }
      Kijun_Buffer[i]=(high+low)/2;
      i--;
     }
//---- Senkou Span A
   i=Bars-a_begin+1;
   if(counted_bars>a_begin-1) i=Bars-counted_bars-1;
   while(i>=0)
     {
      price=(Kijun_Buffer[i]+Tenkan_Buffer[i])/2;
      SpanA_Buffer[i]=price;
      SpanA2_Buffer[i]=price;
      i--;
     }
//---- Senkou Span B
   i=Bars-Senkou;
   if(counted_bars>Senkou) i=Bars-counted_bars-1;
   while(i>=0)
     {
      high=High[i]; low=Low[i]; k=i-1+Senkou;
      while(k>=i)
        {
         price=High[k];
         if(high<price) high=price;
         price=Low[k];
         if(low>price)  low=price;
         k--;
        }
      price=(high+low)/2;
      SpanB_Buffer[i]=price;
      SpanB2_Buffer[i]=price;
      i--;
     }
//---- Chinkou Span
   i=Bars-1;
   if(counted_bars>1) i=Bars-counted_bars-1;
   while(i>=0) { Chinkou_Buffer[i]=Close[i]; i--; }
//----
   return(0);
  }
//+------------------------------------------------------------------+