<metadata>
b08cfbc4532b84e93f530a2a8bfd83e6b2c01566caa30b64cea0a8959dbfddec5f7196a6c4e6b191a8cddfb1cead6a05f39789e00668a0c7467b8aa888fd641092f4795493ab3c1ef2cd1d233905620f711e0367384dcaa60c6939198ef89bfef98b14677118650ab5dbe6dbb496e8d93917162670524f71fcc05b350a6b7a170267ac923a6e394b9de8c4a13f1f1e4dd5a1a5d71772086603647206f29a5e7eaee707695f3b7613e890cef21b347719dcbdbcd1630698a6ecd0e692374e97e79efb0b35763fbbd5cda9c5ac761589e83347a6c91a683f0347685b2f0c756111ee8becd2b5893a5698f93957e18606733f5e3255e88d2917d69b2677307c3b0fb589a689066a4f2ea8c6a4c3a1d45b3a33543752f4caf9c5eb8a4530dbafe58d345b86f4251bc0fc270897f698edd7a3c6aea5ca05776a54231f9ffc224da2cf3d4d38591678a4ddfac47a466649a5c692fd224f7101c6a7e58bc6bfd6e8122ec7a491fed7bac8a5395c107e7206e291a59b91c50d7f8ffa294ca080491a235776049ffa16785730c2b6b8d0e8c85c15c4aa37539bfecfb7c8f46946741781ee8ce12548cbae711f3541d5a64c72f2ce31528ae5324284fdb4c6274e1d7a157d4034daa99ca2b38f6946d4b71976a3d34f36d7a593fa6f08167e3a4eef9c6a5492aeeb8f79187703b5d0b6f973151f5cfa88cca9bddcbbcfe48da6c9204e655be9d8b680ac827a4b90a2a88695a71929e1d1e3dad4e8b49bcfab08693b4f610406498aec0c4f443650351677dfab533afb942b453907a09cbcd9dda535452f6b3756ea9e4a2fc3fdfaca61509eb01727d7e6c0ee0030c5f5211148798cb0311e3c59afd7f585e4a01b7a6c1843265e60e8d43848d7b62e5d0c7f7d0a204f592bf094427c7945230c493930514a398bf84c3b48273c4e2246784689b546296f1ae09497e736437501211fffa4d5f06d3d2a7881ce6f28d381d8991e5382a781dcc39f4c050e60f7935a33c0a385e47c08f19efe8c17640e52f4c8f1de751a6a1f6b1feb9bb2c7e296f8c6714d6e0b97efea8b6907df930b6a4628d1b6605eb7e70c7e1e71f2a633413554f09483e682f04f035b3a0c62f6914a3ffc9d1473fd988fb32609076285fdeb8a7f115915305196f8086f3608102c7d0f1c79b9df83e65c2e1e7bbdd334575d38abd8f7c9b589c6b4b3d6f492ee8b9be91d78c1af8fecf792c4faedb63b1e04543260135c2a6d095b15540a47c6e3d18ce5b9b0e0e889395a117a0263a5c2acc96f1c3c60b7da4e3fbbd77c489db30e7eea890b66437f91be681afd987214a7c2b2c0f792a2cc7c1f0065c5fbdee2bf9097e599fc9ff990f57a085431016f76158eeb51224876a599b3dab0de1f7b7e17cba88feea5d183ecb5c76b2401715420a2cba9c6f69894e7b696d0a3066350201d7c3b493958aeda2b4e81bc57750c5884f61f6ab7d2d5f71c22467a8ae688e17816d1b456761876482998f5adc8fcc1a98b94d8432a2f41f297a6864c7d6a489dbd3556721dfd91ea85d2a0f5c8c8ea55784b79c1f46b5d735159798efd2551a7dedab6b5d0dce10f2ddcecd7f5a686f780fc952a4e0074fa920e339dbf4170c9eba9894a39b2cb315c3654345b1874d7eaa88acefc9eaf3700496b50706711b3daa4d7086182e0d8b4fe9b261bf2d00b5fe49664118bee73516a546b576a45d4b8ed841e70a3c67e400e32dcf3e089345a385c9cf5c2a18fee3145ea8566146a254d3ded99d0b9bfd0b0dec9ba6e50526e14670e6bb7c52a430e6b5023a8967432d6b79af6097a9cf994a8ffd0dba886e3a5d7ec853d58d6a54678dde1681a75108ffb9dc96d14cabaf89d4d739cd8a6c955203a58bbd7a0c5122e69469fed5d382b5f3a6e4f363d4d6f0a2719407c066b91f0add5baf839581361d9aab6f4e5843350dfb4784691a1320ef5daf9942243651df2b0b8d9225084f7a3e1d5b4f390fc97211f79456f0ac5abadcc64068de1294ce9a8a5c9a2c7087af48014674b752462325319750a799bfe704c052ae683b7d990f14d2f35595a3f6d2c1e726b0e52201367b3c07f4158648feab9d7e283ccae0f63315426657c11b8ccbac8e59c764822648decc8a41f6c5e3bac90654a91f4afc15130dab8f09cceabe1a24d204135c8badfa62c1282be43267e101776187a9cf0acc9d39a98f6b7c300726d0c4a28f0916311e7d9783eaccdcda190e3b0d54975644bc7a2d4ba7e1f87e56e02a5c07d34412f22565725d7b6bfdd402126544b751529557a1d709af537534530224e4623b18f98ca6053818ac32cca3b6fec46bfe81d
</metadata>
//---------------------------------------------------
// Project: TSI
// Language: MQL4
// Type: Indicator
// Author: 
// Company: 
// Copyright: 
// Created: 16.12.2009
//---------------------------------------------------

#property indicator_separate_window
#property indicator_buffers 1
#property indicator_color1 Yellow
//---- input parameters
extern int       First_R=5;
extern int       Second_S=8;
//---- buffers
double TSI_Buffer[];
double MTM_Buffer[];
double EMA_MTM_Buffer[];
double EMA2_MTM_Buffer[];
double ABSMTM_Buffer[];
double EMA_ABSMTM_Buffer[];
double EMA2_ABSMTM_Buffer[];
//+------------------------------------------------------------------+
//| Custom indicator initialization function                         |
//+------------------------------------------------------------------+
int init()
  {
//---- indicators
   IndicatorBuffers(7);
   SetIndexBuffer(1, MTM_Buffer);
   SetIndexBuffer(2, EMA_MTM_Buffer);
   SetIndexBuffer(3, EMA2_MTM_Buffer);
   SetIndexBuffer(4, ABSMTM_Buffer);
   SetIndexBuffer(5, EMA_ABSMTM_Buffer);
   SetIndexBuffer(6, EMA2_ABSMTM_Buffer);

   SetIndexStyle(0,DRAW_LINE);
   SetIndexBuffer(0,TSI_Buffer);
   SetIndexLabel(0,"TSI");
//----
   return(0);
  }
//+------------------------------------------------------------------+
//| Custor indicator deinitialization function                       |
//+------------------------------------------------------------------+
int deinit()
  {
//---- TODO: add your code here
   
//----
   return(0);
  }
//+------------------------------------------------------------------+
//| Custom indicator iteration function                              |
//+------------------------------------------------------------------+
int start()
  {
   int    counted_bars=IndicatorCounted();
   int limit,i;
   limit=Bars-counted_bars-1;
   for (i=Bars-1;i>=0;i--)
      {
      MTM_Buffer[i]=Close[i]-Close[i+1];//iMomentum(NULL,0,1,PRICE_CLOSE,i);
      ABSMTM_Buffer[i]=MathAbs(MTM_Buffer[i]);
      //TSI_Buffer[i]=ABSMTM_Buffer[i];
      }
      
   for (i=Bars-1;i>=0;i--)
      {
      EMA_MTM_Buffer[i]=iMAOnArray(MTM_Buffer,0,First_R,0,MODE_EMA,i);
      EMA_ABSMTM_Buffer[i]=iMAOnArray(ABSMTM_Buffer,0,First_R,0,MODE_EMA,i);
      //TSI_Buffer[i]=EMA_ABSMTM_Buffer[i];
      }

   for (i=Bars-1;i>=0;i--)
      {
      EMA2_MTM_Buffer[i]=iMAOnArray(EMA_MTM_Buffer,0,Second_S,0,MODE_EMA,i);
      EMA2_ABSMTM_Buffer[i]=iMAOnArray(EMA_ABSMTM_Buffer,0,Second_S,0,MODE_EMA,i);
      //TSI_Buffer[i]=EMA2_ABSMTM_Buffer[i];
      }

   for (i=Bars-1;i>=0;i--)
      {
      TSI_Buffer[i]=100.0*EMA2_MTM_Buffer[i]/EMA2_ABSMTM_Buffer[i];
      }
      
//---- TODO: add your code here
   
//----
   return(0);
  }
//+------------------------------------------------------------------+