<metadata>
4e728eb1f38bff929df1ae8e96e094f1c0b2592ae0897c135d33dce11032023329077e4eb496fcdc1e7b543ac1a2cea15b3f365fa3cda3c4a4997755d9ac87f3bed8efc2d9e1e1c3e3dc8bb5cef2711cec83a5c12451c7ab73165d7da2d4debb3a487704234aa5cacaa4407d86a40637200ed8e87052af91fcc0751b3657315c197caa94693a04706f000e6d3e563051285b0e7a3059dab9dbe7daf5e58ba1c0e78a7411427ca9957f0b98e13e4e3f5a231de0a9dab496f20b6203603b5a1367066981f3132faf8037431d64cababcd992accbf7026e4b2a4a248dea3a4f79183a5df5903907e3aecf9e8cc06551a5996a45b2de33523856dfb816638ced9ef97a1fcef0734f93f2b0c57f0b157d492624569fa18fe76612067254240c361d32755aec9be295a7d07759c7aaadc8d3a7c3a2e5944f3a0c636511066352216749670911747e0a1d32a69a745b30512451671388e0375889fbe6d8023e44274e21c5a850209afb721cb5cc231ddc9f1b744528d6a631505f31b6cf25193b1492f1ef80f09d79099cfd741a7d04a896c1fd2a492c43d0bd1a773451a2ccbace1063536d251995ba93f008676904167b8eebbdd3e094790acdf3370b4320ee8188f8b2cb1466137a5c3b5d355c2875069aa4cb8892fda1d1f0892c5e41284423325aa3d7cbeb6ac396b66c5e1222b989487c0d213c1c6429e1848df9c3a2a0f15c29aec1b7c3ceab9ae97252c192422d22446612621506671b695431d1f1cf8cc4ab0371deae351b221e735ca9caf699d8a8a2db8ffd70197e1996fef480d9aadbe5370bcca8a6c7ee9a197c77386e080744cfbd1b7ec2a33c48d3ba4f20244a112fbc8e487c3d137a4ab486fcd2f9cbc5f518293302320e7c531d7975143145f491256ae7811e5dfa884c2990f15b2f5039caa5b8d65e60e0dc432628509dedffbbd3b29de9ec89bf815d6d6e5f705e0737eadbfed0407049791a2a82b3f6ca86a95c396a12addd7c38a0c1b5c16005a59b714da9d9c5a4dcaf01729aeda1cea5d777136f519ca0a18ef989a3c25023780b54234926d9ab3c58bf8188b46a0f88f06a0bd8b6efa375141c72d2b5c6f8a0f096e482ed6034e193d8b9c9ada6c39eec4d01f6970866b0d766135a3b781f1075d1edfed17114e29a7415c2ac561af697a7c9d4b39aa487bb384adfba0365395c2a58caafc7a9f89beb8efc8f6e5049751062d8bd30568de83f4d5237b2dcaccff396102e7d26ba9ff1a10f5d95da7f3880d2da9b85c8230654095408f2a227465132610a1f7e0463f590f083b9e5335ef081f29e0c387856255553302449ae92fad5a1d340257d1bf194b6c4dfba97f9b0d31471f9c7cef2eac53b490e6b3c5a7e1b7d0fd0b52d43d4b71c794d3e2c127b47afc6701e66024d24e08380e1d6a23d5247357f30443495e1ee87deb1036d3d4ea484fd8e7a1fcbbb93f2e59756374632b8dd063b67452d797705afda395cb7952c12eed2a0cccca5d9b7b1d46f4fe08e4524f29fea8f241915373b77fb92335d2d48d4f40233cbe93f1f35563b54422e8ae5bdcf7b466547b69b1928784c6c5ae1d2aa9efccf81b3d2e4e4c6b696ddae4b3ff68ffa96375235083f1dcafa446687a790e758317410d3a71971487598ba4f7ebf9d9fbf94e7f78e6a0790f294fb3f5308356745a59797a6e9de5577a0802b5ded84d9aae68fddbf6d014326f5c8f6d48adeed9fc7b290f5193b8cb25d61072879155d342846620793ad231f5b37f29bf79998fdf2d2b8d60362d2bfadc8526f8daffdb14b22a8c680e5dafa4c7d5577d5f57013c0af0b67503f77052518a381cee3596fa5909faa02314f798daf4464017286f25c256e023653cdf053712f1ff7d562423146e188eb8fed992a42271a94b6ffce3210ba9a1d6eb7ce315cf1938ae53c50ccf1d0f21c2e2f1e093e14362202cabc3a5381f2bdd4187a4f2360059da0b290c59189fbcbbeeb8ed2f0744a102c59769ef20b6206687114caf49fa3b996f891751b670394fd1d7e8eefc3b76b047d0fc986a1d13145264f2a45553bd9aa350bc4f8aedd583d2d5fbad332572d5e99a783c5d7b6462aa8dba9ccd0ece8c7dcaf3e5b3042365f452075061c22a39faad892f7dbaf5c08661f7404b9dc0f31f3b7d9b6285d791b7b1703660a3693bcb1c3c6a32155e3b74138fd8d4d287c42a498670af4958af24002badbfb89760594d65f3e07640c671a247e4e033f8ca385e8e485097166240f6ea3d1c3b00a484425e685f19a427c93af0c6908662b4aadcf006c0a6f5514016d8de85d2fafdb5f2c66580543b6d76e02bdcefd9848744b64d4b1a0ced3b2791b6f03b7d284c53559284dbfcd087c3340330d6854086db8d67819f496dab6bbde692a5b368afe2456ec95c8f65016ef8ebbd735463055d7eb0a25721792fcf899d1b3432faecbdb98c5a8cdb95220621b8fb1a69a7a1f6d03b5d463018be75237a9e0fb954d39097bafce3e5ce485790b82bc7137e0816a060477ea8f261adbf43356bcd242238be9a6ca7b1e7f36016f611591e3c2a39bf9b6d7611386b8e9d5725d701d640beb8fa8dded81afca69572682986f47aa723b54f310e1c8668461
</metadata>
//+------------------------------------------------------------------+
//|                                                   Stochastic.mq4 |
//|                      Copyright © 2004, MetaQuotes Software Corp. |
//|                                       http://www.metaquotes.net/ |
//+------------------------------------------------------------------+
#property copyright "Copyright © 2004, MetaQuotes Software Corp."
#property link      "http://www.metaquotes.net/"

#property indicator_separate_window
#property indicator_minimum 0
#property indicator_maximum 100
#property indicator_buffers 2
#property indicator_color1 LightSeaGreen
#property indicator_color2 Red
//---- input parameters
extern int KPeriod=5;
extern int DPeriod=3;
extern int Slowing=3;
//---- buffers
double MainBuffer[];
double SignalBuffer[];
double HighesBuffer[];
double LowesBuffer[];
//----
int draw_begin1=0;
int draw_begin2=0;
//+------------------------------------------------------------------+
//| Custom indicator initialization function                         |
//+------------------------------------------------------------------+
int init()
  {
   string short_name;
//---- 2 additional buffers are used for counting.
   IndicatorBuffers(4);
   SetIndexBuffer(2, HighesBuffer);
   SetIndexBuffer(3, LowesBuffer);
//---- indicator lines
   SetIndexStyle(0,DRAW_LINE);
   SetIndexBuffer(0, MainBuffer);
   SetIndexStyle(1,DRAW_LINE);
   SetIndexBuffer(1, SignalBuffer);
//---- name for DataWindow and indicator subwindow label
   short_name="Sto("+KPeriod+","+DPeriod+","+Slowing+")";
   IndicatorShortName(short_name);
   SetIndexLabel(0,short_name);
   SetIndexLabel(1,"Signal");
//----
   draw_begin1=KPeriod+Slowing;
   draw_begin2=draw_begin1+DPeriod;
   SetIndexDrawBegin(0,draw_begin1);
   SetIndexDrawBegin(1,draw_begin2);
//----
   return(0);
  }
//+------------------------------------------------------------------+
//| Stochastic oscillator                                            |
//+------------------------------------------------------------------+
int start()
  {
   int    i,k;
   int    counted_bars=IndicatorCounted();
   double price;
//----
   if(Bars<=draw_begin2) return(0);
//---- initial zero
   if(counted_bars<1)
     {
      for(i=1;i<=draw_begin1;i++) MainBuffer[Bars-i]=0;
      for(i=1;i<=draw_begin2;i++) SignalBuffer[Bars-i]=0;
     }
//---- minimums counting
   i=Bars-KPeriod;
   if(counted_bars>KPeriod) i=Bars-counted_bars-1;
   while(i>=0)
     {
      double min=1000000;
      k=i+KPeriod-1;
      while(k>=i)
        {
         price=Low[k];
         if(min>price) min=price;
         k--;
        }
      LowesBuffer[i]=min;
      i--;
     }
//---- maximums counting
   i=Bars-KPeriod;
   if(counted_bars>KPeriod) i=Bars-counted_bars-1;
   while(i>=0)
     {
      double max=-1000000;
      k=i+KPeriod-1;
      while(k>=i)
        {
         price=High[k];
         if(max<price) max=price;
         k--;
        }
      HighesBuffer[i]=max;
      i--;
     }
//---- %K line
   i=Bars-draw_begin1;
   if(counted_bars>draw_begin1) i=Bars-counted_bars-1;
   while(i>=0)
     {
      double sumlow=0.0;
      double sumhigh=0.0;
      for(k=(i+Slowing-1);k>=i;k--)
        {
         sumlow+=Close[k]-LowesBuffer[k];
         sumhigh+=HighesBuffer[k]-LowesBuffer[k];
        }
      if(sumhigh==0.0) MainBuffer[i]=100.0;
      else MainBuffer[i]=sumlow/sumhigh*100;
      i--;
     }
//---- last counted bar will be recounted
   if(counted_bars>0) counted_bars--;
   int limit=Bars-counted_bars;
//---- signal line is simple movimg average
   for(i=0; i<limit; i++)
      SignalBuffer[i]=iMAOnArray(MainBuffer,Bars,DPeriod,0,MODE_SMA,i);
//----
   return(0);
  }
//+------------------------------------------------------------------+